{% extends 'base.html' %}

{% block content %}
<body> 
    <div class="container">
        <!-- Left Side (File Upload) -->
        <div class="left">
            <form id="upload-form">
                <input type="file" id="file-upload" multiple> <!-- Allow multiple files -->
                <label for="file-upload" class="upload-btn">Choose Files</label>
                <button type="submit" class="upload-btn">Upload</button> <!-- Upload button -->
                <button class="convert-btn" id="convert">Convert</button>
            </form>
            <ul id="file-list"></ul> <!-- List to display uploaded files -->
            <div id="results-container" class="results-section"></div>
        </div>

        <!-- Right Side (Text and Buttons) -->
        <div class="right">
            <h1>Convert Your Notes to Docs</h1>
            <p>Upload your handwritten notes and instantly convert them into a digital document with AI-powered accuracy.</p>
            <div class="buttons">
                <button class="primary">Sign Up</button>
                <button class="secondary">Login</button>
            </div>
        </div>
    </div>
    const resultHtml = `
                        <div class="result-item">
                            <div class="filename">ðŸ“„ ${filename}</div>
                            <div class="extracted-text">${text}</div>
                        </div>
                    `;
                    resultsContainer.append(resultHtml);
    <script>
        document.getElementById("convert").addEventListener("click", function() {
            fetch("/convert", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ message: "Button clicked!" }) // Optional data
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message); // Log response from Flask
                alert(data.message); // Display alert with response
            })
            .catch(error => console.error("Error:", error));
        });
    </script>
    <script>
        document.getElementById("upload-form").addEventListener("submit", async function(event) {
            event.preventDefault();  // Prevent default form submission
            let formData = new FormData();
            let files = document.getElementById("file-upload").files;

            if (files.length === 0) {
                alert("Please select a file first.");
                return;
            }

            for (let i = 0; i < files.length; i++) {
                formData.append("file", files[i]);  // Append each file
            }

            let response = await fetch("/uploads/upload", {
                method: "POST",
                body: formData
            });

            if (response.ok) {
                fetchFiles(); // Refresh the file list after uploading
            } else {
                alert("File upload failed.");
            }
        });

        async function fetchFiles() {
            let response = await fetch("/uploads/files"); 
            let data = await response.json();
            let fileList = document.getElementById("file-list");
            fileList.innerHTML = ""; // Clear previous list

            data.files.forEach(file => {
                let listItem = document.createElement("li");
                listItem.innerHTML = `<a href="/uploads/download/${file}" target="_blank">${file}</a>`;
                fileList.appendChild(listItem);
            });
        }

        fetchFiles();  // Load files on page load
    </script>
    
</body>  
{% endblock %}
